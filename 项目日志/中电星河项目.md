





# 2024.12.20

修改Xenomai内核版本为4.14.36

**需求：**希望大家都用一个版本的软件





# 2025.2.5

实现在轨重构功能分析





# 2025.2.10

编写LVDS重构交付单，JTAG重构交付单

重构加载计划





## multiboot加载启动

在FLASH存放多份镜像

![image-20250210165836863](./media/image-20250210165836863.png)



因zynq自带multiboot功能，所以不需要进行设置

只需要把在FLASH中放置多份BOOT即可，但是要记住以32K对齐



**参考文献：**

https://blog.csdn.net/weixin_43189165/article/details/97761784

《xapp1175_zynq_secure_boot.pdf》55页

# 2025.2.11

对EMMC进行raid1处理

首先在rootfs上勾选mdadm，然后kernel也需要勾选上raid的驱动支持

内核勾选：

```yaml
 [*] Multiple devices driver support (RAID and LVM)  --->
 
```

**操作步骤**

```bash
## 首先进行磁盘分区 分出1个FAT，两个EXT4
## 磁盘分区完成后，我们可以使用以下命令创建 RAID-1 阵列
mdadm -Cv /dev/md0 -l1 -n2 /dev/mmcblk0p2 /dev/mmcblk0p3

{
-Cv: 创建一个阵列并打印出详细信息。
/dev/md0: 阵列名称。
-l1 (l as in "level"): 指定阵列类型为 RAID-1 。
-n2: 指定我们将两个分区加入到阵列中去，分别为/dev/sdb1 和 /dev/sdc1
}
## 创建完之后 会进行同步
## 使用mdadm命令查看RAID阵列的状态
mdadm --detail /dev/md0

## 可以使用以下命令查看进度
cat /proc/mdstat 

## 等待同步完成 会打印下面的信息
root@zc706-board:~# md: md0: resync done.

## 下一步就是格式化阵列了，本例中使用ext4格式
mkfs.ext4 /dev/md0

## 现在可以加载阵列并验证其正常挂载
mount /dev/md0 /mnt
## 现在不能挂载/dev/mmcblk0p2和/dev/mmcblk0p3 已经被 RAID 管理器（mdadm）所占用
## 现在存文件或者根文件系统 直接放到/dev/md0挂载的位置即可
```





**RAID阵列状态：**

```yaml
root@zc706-board:~# mdadm --detail /dev/md0
/dev/md0:
           Version : 1.2
     Creation Time : Fri Mar  9 12:49:36 2018
        Raid Level : raid1
        Array Size : 12490752 (11.91 GiB 12.79 GB)
     Used Dev Size : 12490752 (11.91 GiB 12.79 GB)
      Raid Devices : 2
     Total Devices : 2
       Persistence : Superblock is persistent

       Update Time : Fri Mar  9 12:55:35 2018
             State : clean, resyncing
    Active Devices : 2
   Working Devices : 2
    Failed Devices : 0
     Spare Devices : 0

Consistency Policy : resync

     Resync Status : 34% complete

              Name : zc706-board:0  (local to host zc706-board)
              UUID : a1dae124:13c4740a:1b311b82:32f8b912
            Events : 5

    Number   Major   Minor   RaidDevice State
       0     179        2        0      active sync   /dev/mmcblk0p2
       1     179        3        1      active sync   /dev/mmcblk0p3
```

**State**：这应该是`clean`表示阵列是健康的。如果是`resyncing`，表示阵列正在进行同步过程。

**Active Devices**：表示阵列中正常工作的设备数量。

**Failed Devices**：表示阵列中发生故障的设备数量。

**Resync Status**：如果阵列正在同步，这个字段会显示同步进度。

```yaml
root@zc706-board:~# cat /proc/mdstat
Personalities : [raid1]
md0 : active raid1 mmcblk0p3[1] mmcblk0p2[0]
      12490752 blocks super 1.2 [2/2] [UU]
      [========>............]  resync = 43.3% (5409408/12490752) finish=10.8min speed=10892K/sec

unused devices: <none>
```

`UU` 表示两个镜像磁盘都健康。

如果是 `[U_]` 或 `[__]`，则表示某个磁盘存在故障或阵列不完全。

**Resync Progress**：显示重同步进度，直到它完成。





**参考文章：**

https://linux.cn/article-4891-1.html





# 2025.2.14

因为直接从raid启动根文件系统，启动不起来所以有以下策略



思路：首先使用initramfs进入系统，然后用switch_root切换新的根文件系统































