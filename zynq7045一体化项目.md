# 客户开发板烧录系统

**启动模式**

QSPI + EMMC

**系统文件存储**

| 存储位置  | 存储文件           | 说明                  |
| :-------- | ------------------ | --------------------- |
| FLASH：   | BOOT.bin           | fsbl、u-boot.elf、bit |
| mmcblk0p1 | uImage、system.dtb | 内核、设备树          |
| mmcblk0p2 | 根文件系统         | 解压rootfs.tar.gz     |



## 启动petalinux系统

1、首先通过JTAG把BOOT_uboot.bin烧写到FLASH

2、启动u-boot，并配置u-boot网络

```shell
setenv ipaddr 192.168.0.10
setenv serverip 192.168.0.1
saveenv
```

3、通过TFTP下载内核文件

```shell
## 下载rmdisk(INITRD)
tftpboot 0x10000000 image.ub

## 指定地址传输
tftpboot 0x10000000 192.168.3.110:BOOT.BIN

## 启动rmdisk
bootm 0x10000000
```

4、配置linux网络

```shell
ifconfig eth0 192.168.0.10 netmask 255.255.255.0
```

5、烧录根文件系统、内核、设备树

```shell
## 下载内核
tftp -g -r uImage 192.168.0.1

## 下载根文件系统
tftp -g -r rootfs.tar.gz 192.168.0.1

## 下载设备树
tftp -g -r system.dtb 192.168.0.1
```

**说明：**

mmcblk0p1：uImage、system.dtb

mmcblk0p2：rootfs.tar.gz

6、配置启动指令

```shell
## 添加指令
setenv my_emmc_boot "mmc dev 0:1 && load mmc 0:1 0x10000000 /uImage && load mmc 0:1 0x20000000 system.dtb && bootm 0x10000000 - 0x20000000"

## 将bootcmd的命令修改成my_emmc_boot
setenv bootcmd "run my_emmc_boot" 

## 保存环境变量
saveenv

## 重新加载u-boot
reset
```

